### js/taskModel.js（任务数据结构定义）  

基于“pone&jome 代办小程序”需求设计的任务数据结构模型，用于标准化任务对象的属性和方法，确保数据一致性与可扩展性：  


#### **核心代码**  
```javascript
/**
 * 任务数据结构模型（Task Model）
 * 定义任务的基础属性、子任务结构及数据验证方法
 */
class TaskModel {
  /**
   * 创建任务实例
   * @param {Object} taskData - 任务原始数据（从表单或本地存储获取）
   * @param {string} taskData.id - 任务唯一标识（建议用时间戳+随机数生成）
   * @param {string} taskData.name - 任务名称（如“六级备考”“课程论文”）
   * @param {string} taskData.startDate - 任务起始日期（格式：YYYY-MM-DD）
   * @param {string} taskData.endDate - 任务结束日期（格式：YYYY-MM-DD）
   * @param {number} taskData.totalGoal - 任务总目标值（如3000词、5套真题）
   * @param {string} taskData.unit - 目标单位（如“词”“套”“小时”）
   * @param {Array} [taskData.subTasks=[]] - 子任务列表（默认空数组，由拆分算法生成）
   * @param {string} [taskData.status='active'] - 任务状态（active：进行中；completed：已完成；paused：暂停）
   */
  constructor(taskData) {
    // 基础属性（必填）
    this.id = taskData.id || this.generateId(); // 生成唯一ID（若未传入）
    this.name = this.validateName(taskData.name); // 验证任务名称非空
    this.startDate = this.validateDate(taskData.startDate); // 验证日期格式
    this.endDate = this.validateDate(taskData.endDate); // 验证日期格式
    this.totalGoal = this.validateGoal(taskData.totalGoal); // 验证目标值为正数
    this.unit = taskData.unit || '个'; // 默认单位为“个”（如未指定）
    
    // 衍生属性（可选/自动生成）
    this.subTasks = taskData.subTasks || []; // 子任务列表（结构见下方）
    this.status = taskData.status || 'active'; // 任务状态
    this.createdAt = new Date().toISOString(); // 任务创建时间（ISO格式）
    this.progress = this.calculateProgress(); // 任务总进度（百分比）
  }

  /**
   * 生成任务唯一ID（时间戳+随机数）
   * @returns {string} 格式："task_1695000000000_1234"
   */
  generateId() {
    const timestamp = Date.now();
    const random = Math.floor(Math.random() * 10000);
    return `task_${timestamp}_${random}`;
  }

  /**
   * 验证任务名称（非空）
   * @param {string} name - 任务名称
   * @returns {string} 验证通过的名称
   * @throws {Error} 若名称为空或仅含空格，抛出错误
   */
  validateName(name) {
    if (!name || name.trim() === '') {
      throw new Error('任务名称不能为空');
    }
    return name.trim();
  }

  /**
   * 验证日期格式（YYYY-MM-DD）
   * @param {string} dateStr - 日期字符串
   * @returns {string} 验证通过的日期
   * @throws {Error} 若格式错误或结束日期早于起始日期，抛出错误
   */
  validateDate(dateStr) {
    const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
    if (!dateRegex.test(dateStr)) {
      throw new Error('日期格式错误，请使用YYYY-MM-DD');
    }
    // 若为结束日期，需确保不早于起始日期（仅在startDate已定义时验证）
    if (this.startDate && dateStr < this.startDate) {
      throw new Error('结束日期不能早于起始日期');
    }
    return dateStr;
  }

  /**
   * 验证目标值（正数）
   * @param {number} goal - 总目标值（如3000、5）
   * @returns {number} 验证通过的目标值
   * @throws {Error} 若目标值非正数，抛出错误
   */
  validateGoal(goal) {
    const numGoal = Number(goal);
    if (isNaN(numGoal) || numGoal <= 0) {
      throw new Error('目标值必须为正数（如3000、5）');
    }
    return numGoal;
  }

  /**
   * 计算任务总进度（基于子任务完成量）
   * @returns {number} 进度百分比（保留1位小数，如35.2）
   */
  calculateProgress() {
    if (this.subTasks.length === 0) return 0; // 无子任务时进度为0
    const completed = this.subTasks.reduce((sum, subTask) => {
      return sum + (subTask.completedValue || 0); // 累加已完成子任务值
    }, 0);
    return Number(((completed / this.totalGoal) * 100).toFixed(1));
  }

  /**
   * 获取子任务结构模板（用于任务拆分时标准化子任务）
   * @param {Object} subTaskData - 子任务数据
   * @param {string} subTaskData.level - 子任务层级（month：月；week：周；day：日）
   * @param {string} subTaskData.period - 周期描述（如“2023-09”“第10周”）
   * @param {number} subTaskData.targetValue - 子任务目标值（如1000词/月）
   * @param {number} [subTaskData.completedValue=0] - 已完成值（默认0）
   * @returns {Object} 标准化的子任务对象
   */
  static getSubTaskTemplate(subTaskData) {
    return {
      id: `sub_${Date.now()}_${Math.floor(Math.random() * 1000)}`, // 子任务唯一ID
      level: subTaskData.level, // month/week/day
      period: subTaskData.period, // 周期标识
      targetValue: Number(subTaskData.targetValue), // 目标值（数字类型）
      completedValue: subTaskData.completedValue || 0, // 已完成值（默认0）
      updatedAt: new Date().toISOString() // 最后更新时间
    };
  }
}

// 导出任务模型，供其他模块（如taskAdd.js、taskSplit.js）调用
export default TaskModel;
```


#### **设计说明**  
1. **核心属性设计**  
   - **基础属性**：`id`（唯一标识）、`name`（任务名称）、`startDate`/`endDate`（时间范围）、`totalGoal`（总目标值）、`unit`（目标单位），均通过构造函数参数传入并严格验证，确保数据合法性。  
   - **衍生属性**：`subTasks`（子任务列表，结构由`getSubTaskTemplate`方法标准化）、`status`（任务状态）、`progress`（总进度，自动计算），支持任务全生命周期管理。  

2. **子任务结构**  
   子任务通过静态方法`TaskModel.getSubTaskTemplate()`生成，包含层级（`level`：月/周/日）、周期（`period`：如“2023-09”）、目标值（`targetValue`）和已完成值（`completedValue`），适配“总任务→子任务”的拆解逻辑（如“3000词→每月1000词→每周250词”）。  

3. **数据验证**  
   通过`validateName`、`validateDate`、`validateGoal`等方法，确保任务名称非空、日期格式正确（YYYY-MM-DD）、目标值为正数，避免无效数据录入。  

4. **可扩展性**  
   预留`status`（任务状态）、`createdAt`（创建时间）等属性，支持后续扩展“任务筛选（按状态）”“历史记录查询”等功能；子任务层级（`level`）可扩展为“学期”“学年”（如后续支持更大时间粒度的规划）。  


#### **使用示例**  
```javascript
// 1. 导入TaskModel
import TaskModel from './taskModel.js';

// 2. 创建任务数据（模拟从表单获取）
const rawTaskData = {
  name: '六级备考',
  startDate: '2023-09-01',
  endDate: '2023-11-30',
  totalGoal: 3000,
  unit: '词'
};

// 3. 实例化任务（自动触发数据验证）
try {
  const newTask = new TaskModel(rawTaskData);
  console.log('任务创建成功：', newTask);
  // 输出示例：{ id: "task_1693500000000_1234", name: "六级备考", ... }
} catch (error) {
  console.error('任务创建失败：', error.message);
}
```  

该模型可无缝对接本地存储（`storage.js`）、任务拆解（`taskSplit.js`）和页面渲染（`render.js`）模块，为小程序提供标准化的任务数据管理能力。
